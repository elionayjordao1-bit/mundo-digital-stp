<!-- ðŸ”§ ARQUIVO CORRIGIDO â€“ PERMISSÃ•ES CERTAS -->
<script>
let ROLE="";

auth.onAuthStateChanged(async u=>{
if(u){
loginBox.classList.add("hidden");
app.classList.remove("hidden");
userEmail.innerText=u.email;

const doc=await db.collection("usuarios").doc(u.uid).get();
ROLE=doc.data().role;
userRole.innerText=ROLE;

aplicarPermissoes();
carregar();
}else{
loginBox.classList.remove("hidden");
app.classList.add("hidden");
}
});

function aplicarPermissoes(){
/* RELATÃ“RIO */
if(ROLE!=="admin"){
document.getElementById("relatorio").style.display="none";
}

/* CADASTRO PRODUTO */
if(ROLE!=="admin"){
document.getElementById("novoProduto").style.display="none";
}

/* COLUNAS */
if(ROLE==="vendas"){
document.getElementById("thEntrada").style.display="none";
document.getElementById("thExcluir").style.display="none";
}
if(ROLE==="estoque"){
document.getElementById("thVenda").style.display="none";
document.getElementById("thExcluir").style.display="none";
}
}

function addProduto(){
if(ROLE!=="admin"){
alert("Sem permissÃ£o");
return;
}
db.collection("produtos").add({
nome:nome.value,
estoque:+estoque.value,
minimo:+minimo.value,
compra:+compra.value,
venda:+venda.value
});
}

function mov(id,nome,atual,preco,t){
if(ROLE==="vendas" && t==="entrada") return;
if(ROLE==="estoque" && t==="saida") return;

let q=+prompt("Quantidade:");
if(!q||q<=0)return;
let novo=t=="entrada"?atual+q:atual-q;
if(novo<0)return alert("Estoque insuficiente");

db.collection("produtos").doc(id).update({estoque:novo});
db.collection("movimentacoes").add({
produto:nome,
tipo:t,
quantidade:q,
valor:q*preco,
usuario:auth.currentUser.email,
data:new Date()
});
}

function del(id){
if(ROLE!=="admin") return;
if(confirm("Excluir produto?")){
db.collection("produtos").doc(id).delete();
}
}
</script>
