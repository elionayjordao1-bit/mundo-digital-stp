<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mundo Digital STP</title>

<!-- Firebase COMPAT (essencial para GitHub Pages) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
h1{text-align:center}
input,button{padding:8px;margin:4px}
table{width:100%;border-collapse:collapse;background:#fff;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#2c7be5;color:#fff}
.hidden{display:none}
.card{background:#fff;padding:15px;margin:10px 0;border-radius:6px}
</style>
</head>

<body>

<h1>üè™ Mundo Digital STP</h1>

<div id="login">
  <h3>Login</h3>
  <input id="email" placeholder="Email">
  <input id="senha" type="password" placeholder="Senha">
  <button onclick="login()">Entrar</button>
  <p id="erro" style="color:red"></p>
</div>

<div id="app" class="hidden">
  <p>Usu√°rio: <b><span id="userEmail"></span></b></p>
  <button onclick="logout()">Sair</button>

  <div class="card">
    <h3>üì¶ Cadastro de Produto</h3>
    <input id="produto" placeholder="Produto">
    <input id="estoque" type="number" placeholder="Quantidade">
    <input id="preco" type="number" placeholder="Pre√ßo">
    <button onclick="addProduto()">Salvar</button>
  </div>

  <div class="card">
    <h3>üìã Estoque</h3>
    <table>
      <thead>
        <tr>
          <th>Produto</th>
          <th>Qtd</th>
          <th>Pre√ßo</th>
          <th>Venda</th>
        </tr>
      </thead>
      <tbody id="lista"></tbody>
    </table>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBCw8qEFmYrBbRnDM4OFCgx-44FUtSbqts",
  authDomain: "mundo-digital-stp.firebaseapp.com",
  projectId: "mundo-digital-stp",
  storageBucket: "mundo-digital-stp.appspot.com",
  messagingSenderId: "1062673569126",
  appId: "1:1062673569126:web:2e44ecbf098d90931464a7"
};

// üî• INICIALIZA√á√ÉO CORRETA
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

// üîê LOGIN
function login(){
  auth.signInWithEmailAndPassword(
    document.getElementById("email").value,
    document.getElementById("senha").value
  ).catch(e=>{
    document.getElementById("erro").innerText = e.message;
  });
}

function logout(){
  auth.signOut();
}

// üîÑ ESTADO DE LOGIN
auth.onAuthStateChanged(user=>{
  if(user){
    document.getElementById("login").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    document.getElementById("userEmail").innerText = user.email;
    carregar();
  } else {
    document.getElementById("login").classList.remove("hidden");
    document.getElementById("app").classList.add("hidden");
  }
});

// üì¶ PRODUTOS
function addProduto(){
  db.collection("produtos").add({
    nome: document.getElementById("produto").value,
    estoque: Number(document.getElementById("estoque").value),
    preco: Number(document.getElementById("preco").value),
    criadoEm: new Date()
  });
}

function vender(id, qtd){
  if(qtd <= 0) return;
  db.collection("produtos").doc(id).update({
    estoque: qtd - 1
  });
}

function carregar(){
  db.collection("produtos").onSnapshot(snapshot=>{
    document.getElementById("lista").innerHTML = "";
    snapshot.forEach(doc=>{
      const p = doc.data();
      document.getElementById("lista").innerHTML += `
        <tr>
          <td>${p.nome}</td>
          <td>${p.estoque}</td>
          <td>R$ ${p.preco}</td>
          <td>
            <button onclick="vender('${doc.id}', ${p.estoque})">
              Vender
            </button>
          </td>
        </tr>
      `;
    });
  });
}
</script>

</body>
</html>
